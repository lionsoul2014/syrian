<?php if(!defined('BASEPATH'))exit('No Direct Access Allowed!');define('VERSION','1.0.1');defined('SR_INC_COMPONENTS')or define('SR_INC_COMPONENTS',0xFF);if(!function_exists('_G')){function _G($key,$val=NULL){static $_GRE=array();if($val==NULL){return isset($_GRE["{$key}"])?$_GRE["{$key}"]:NULL;}$_GRE["{$key}"]=&$val;return true;}}class Loader{private function __construct(){}public static function import($_class,$_section=NULL,$_inc=true){static $_loaded=array();$_cls=($_section==NULL)?$_class:$_section.'/'.$_class;if(isset($_loaded[$_cls]))return;$_dir=(($_inc)?BASEPATH.'/lib/':SR_LIBPATH);$_dir.=$_cls;foreach(array($_dir.'.class.php',$_dir.'.php')as $_file){if(file_exists($_file)){require $_file;$_loaded[$_cls]=true;return true;}}exit('Syrian:Loader#import: Unable to load class '.$_class);}public static function config($_config,$_section=NULL,$_inc=false,$key=NULL){$_dir=(($_inc)?BASEPATH.'/config/':SR_CONFPATH);if($_section!=NULL)$_dir.=$_section.'/';$_dir.=$_config;foreach(array($_dir.'.conf.php',$_dir.'.php')as $_file){if(file_exists($_file)){$conf=include $_file;if($key!=NULL){return isset($conf["{$key}"])?$conf["{$key}"]:NULL;}return $conf;}}exit('Syrian:Loader#config: Unable to load config '.$_config);}public static function model($_model,$_section=NULL){static $_loaded=array();$_model=ucfirst($_model);$_cls=($_section==NULL)?$_model:$_section.'/'.$_model;if(isset($_loaded[$_cls])){return $_loaded[$_cls];}$_dir=SR_MODELPATH.$_cls;foreach(array($_dir.'.model.php',$_dir.'.php')as $_file){if(file_exists($_file)){include $_file;$o=NULL;$_class=$_model.'Model';if(class_exists($_class)){$o=new $_class();}else $o=new $_model();$_loaded[$_cls]=$o;return $o;}}exit('Syrain:Loader#model: Unable to load model '.$_model);}public static function helper($_helper,$conf=NULL,$_section=NULL,$_inc=false){static $_loaded=array();$_cls=($_section==NULL)?$_helper:$_section.'/'.$_helper;if(isset($_loaded[$_cls]))return $_loaded[$_cls];$_dir=(($_inc)?BASEPATH.'/helper/':SR_HELPERPATH);$_dir.=$_cls;foreach(array($_dir.'.helper.php',$_dir.'.php')as $_file){if(file_exists($_file)){require $_file;$_class=$_helper.'Helper';$obj=new $_class($conf);$_loaded[$_cls]=&$obj;return $obj;}}exit('Syrian:Loader#helper: Unable to load helper '.$_helper);}}class Helper{public function __construct($conf){}public function load(){$_argv=func_get_args();$_args=func_num_args();if($_args>0&&method_exists($this,$_argv[0])){$cacher=array_shift($_argv);return $this->{$cacher}($_argv);}exit("Error: Unable to load cacher {$_argv[0]}\n");}}if((SR_INC_COMPONENTS&0x08)!=0){defined('OP_NULL')or define('OP_NULL',1<<0);defined('OP_LATIN')or define('OP_LATIN',1<<1);defined('OP_URL')or define('OP_URL',1<<2);defined('OP_EMAIL')or define('OP_EMAIL',1<<3);defined('OP_QQ')or define('OP_QQ',1<<4);defined('OP_DATE')or define('OP_DATE',1<<5);defined('OP_NUMERIC')or define('OP_NUMERIC',1<<6);defined('OP_STRING')or define('OP_STRING',1<<7);defined('OP_ZIP')or define('OP_ZIP',1<<8);defined('OP_CELLPHONE')or define('OP_CELLPHONE',1<<9);defined('OP_TEL')or define('OP_TEL',1<<10);defined('OP_IDENTIRY')or define('OP_IDENTIRY',1<<11);defined('OP_SANITIZE_TRIM')or define('OP_SANITIZE_TRIM',1<<0);defined('OP_SANITIZE_SCRIPT')or define('OP_SANITIZE_SCRIPT',1<<1);defined('OP_SANITIZE_HTML')or define('OP_SANITIZE_HTML',1<<2);defined('OP_MAGIC_QUOTES')or define('OP_MAGIC_QUOTES',1<<3);defined('OP_SANITIZE_INT')or define('OP_SANITIZE_INT',1<<4);defined('OP_LOWERCASE')or define('OP_LOWERCASE',1<<5);defined('OP_UPPERCASE')or define('OP_UPPERCASE',1<<6);if(!function_exists('OP_LIMIT')){function OP_LIMIT($s,$e=-1){return($e==-1?array(0,$s):array(0,$s,$e));}}if(!function_exists('OP_SIZE')){function OP_SIZE($s,$e=-1){return($e==-1?array(1,$s):array(1,$s,$e));}}class Input{private static $_loaded=false;public function __construct(){}private static function checkAndLoadFilter(){if(self::$_loaded==false){Loader::import('Filter');self::$_loaded=true;}}public function get($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_GET[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_GET,$_key,$_model,$_errno);}return $_GET[$_key];}public function getInt($_key,$_default=false,$allow_nagative=false){if(!isset($_GET[$_key]))return $_default;$v=intval($_GET[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function getModel($_model,&$_errno){self::checkAndLoadFilter();return Filter::loadFromModel($_GET,$_model,$_errno);}public function post($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_POST[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_POST,$_key,$_model,$_errno);}return $_POST[$_key];}public function postInt($_key,$_default=false,$allow_nagative=false){if(!isset($_POST[$_key]))return $_default;$v=intval($_POST[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function postModel($_model,&$_errno){self::checkAndLoadFilter();return Filter::loadFromModel($_POST,$_model,$_errno);}public function cookie($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_COOKIE[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_COOKIE,$_key,$_model,$_errno);}return $_COOKIE[$_key];}public function cookieInt($_key,$_default=false,$allow_nagative=false){if(!isset($_COOKIE[$_key]))return $_default;$v=intval($_COOKIE[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function cookieModel($_model,&$_errno){self::checkAndLoadFilter();return Filter::loadFromModel($_COOKIE,$_model,$_errno);}public function session($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_SESSION[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_SESSION,$_key,$_model,$_errno);}return $_SESSION[$_key];}public function request($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_REQUEST[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_REQUEST,$_key,$_model,$_errno);}return $_REQUEST[$_key];}public function requestInt($_key,$_default=false,$allow_nagative=false){if(!isset($_REQUEST[$_key]))return $_default;$v=intval($_REQUEST[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function requestModel($_model,&$_errno){self::checkAndLoadFilter();return Filter::loadFromModel($_REQUEST,$_model,$_errno);}public function server($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_SERVER[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_SERVER,$_key,$_model,$_errno);}return $_SERVER[$_key];}public function env($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_ENV[$_key]))return $_default;if($_model!=NULL){self::checkAndLoadFilter();return Filter::get($_ENV,$_key,$_model,$_errno);}return $_ENV[$_key];}}}if((SR_INC_COMPONENTS&0x10)!=0){defined('URI_DIR_STYLE')or define('URI_DIR_STYLE',0);defined('URI_STD_STYLE')or define('URI_STD_STYLE',1);abstract class Uri{public $url=NULL;public $self=NULL;public $section=NULL;public $module=NULL;public $page=NULL;protected $_base='/';protected $_request=NULL;protected $_style=NULL;protected $_ext=NULL;protected $_rewrite=false;protected $_parts=NULL;public function __construct($_rewrite=false,$_style=URI_STD_STYLE){$this->url=$_SERVER['REQUEST_URI'];$this->self=$_SERVER['REQUEST_URI'];if(($args=strpos($this->self,'?'))!==false){$this->self=substr($this->self,0,$args);}if($this->url[0]!='/')$this->url='/'.$this->url;if($this->self[0]!='/')$this->self='/'.$this->self;$self=$_SERVER['PHP_SELF'];if($self[0]!='/')$self='/'.$self;if(($pos=stripos($self,'.php'))!==FALSE){while($self[$pos]!='/')$pos--;if($pos>0)$this->_base=substr($self,0,$pos+1);}$this->_rewrite=$_rewrite;$this->_style=$_style;}protected function parseUrl(){$_spos=0;$_epos=0;$pos=0;$_url=substr_replace($this->url,'/',0,strlen($this->_base));$_len=strlen($_url);if(($pos=stripos($_url,'.php'))!==FALSE)$_spos=$pos+4;if($_spos<$_len)$_spos++;$_args=stripos($_url,'?',$_spos);$_extp=stripos($_url,'.',$_spos);if($_args!==FALSE&&$_extp!==FALSE)$_epos=min($_args,$_extp);else $_epos=max($_args,$_extp);if($_epos==FALSE)$_epos=$_len;if($_url[$_len-1]=='/')$_epos--;$this->_request=substr($_url,$_spos,$_epos-$_spos);if($this->_request=='')return false;$_ret=explode('/',$this->_request);$this->_parts=&$_ret;return true;}public function redirect($_url,$_args=NULL){$_url=$this->makeStyleUrl($_url,$_args);header('Location: '.$_url);exit();}protected function makeStyleArgs(&$_args){if($this->_style==URI_DIR_STYLE)return('/'.implode('/',$_args));if(is_string($_args))return('?'.$_args);$_str='';$item=NULL;foreach($_args as $_key=>$_val){$item=$_key.'='.$_val;$_str.=($_str=='')?$item:'&'.$item;}return('?'.$_str);}public function makeStyleUrl($_url,$_args=NULL){$_uri=$this->_base;$_uri.=($this->_rewrite?'':'index.php/').$_url;if($this->_ext!=NULL)$_uri.=$this->_ext;if($_args!=NULL)$_uri.=$this->makeStyleArgs($_args);return $_uri;}public function setFileExt($_ext){$this->_ext=$_ext;}public function parseArgsGet($_temp){if($this->_style!=URI_DIR_STYLE)return0;$_plen=count($this->_parts);$_keys=explode('/',$_temp);$_klen=count($_keys);if($_klen+2>$_plen)return false;$_idx=$_plen-$_klen-1;foreach($_keys as $_key){$_GET[$_key]=$this->_parts[$_idx];$_idx++;}return true;}public function getPartById($idx){if($idx>=0&&$idx<count($idx->_parts))return $this->_parts[$idx];return NULL;}protected abstract function getController($_module);}}if((SR_INC_COMPONENTS&0x20)!=0){class Output{private $_header=array();private $_final_output='';private $_zlib_oc=false;private $_gzip_oc=-1;public function __construct(){$this->_zlib_oc=@ini_get('zlib.output_compression');}public function compress($_level){if($this->_zlib_oc==TRUE)return;if($_level>=1&&$_level<=9)$this->_gzip_oc=$_level;}public function setHeader($_header,$_replace){if($this->_zlib_oc&&strncasecmp($_header,'content-length')==0){return;}$this->_header[]=array($_header,$_replace);return $this;}public function setOutput(){$this->_final_output=$_output;return $this;}public function append($_str){$this->_final_output.=$_str;return $this;}public function setStatusHeader($_code,$_string=''){static $_status=array(200=>'OK',201=>'Created',202=>'Accepted',203=>'Non-Authoritative Information',204=>'No Content',205=>'Reset Content',206=>'Partial Content',300=>'Multiple Choices',301=>'Moved Permanently',302=>'Found',304=>'Not Modified',305=>'Use Proxy',307=>'Temporary Redirect',400=>'Bad Request',401=>'Unauthorized',403=>'Forbidden',404=>'Not Found',405=>'Method Not Allowed',406=>'Not Acceptable',407=>'Proxy Authentication Required',408=>'Request Timeout',409=>'Conflict',410=>'Gone',411=>'Length Required',412=>'Precondition Failed',413=>'Request Entity Too Large',414=>'Request-URI Too Long',415=>'Unsupported Media Type',416=>'Requested Range Not Satisfiable',417=>'Expectation Failed',500=>'Internal Server Error',501=>'Not Implemented',502=>'Bad Gateway',503=>'Service Unavailable',504=>'Gateway Timeout',505=>'HTTP Version Not Supported');if(!isset($_status[$_code]))exit('Error: Invalid http status code');if($_string=='')$_string=&$_status[$_code];$_protocol=isset($_SERVER['SERVER_PROTOCOL'])?$_SERVER['SERVER_PROTOCOL']:FALSE;if(substr(php_sapi_name(),0,3)=='cgi'){header("Status: {$_code} {$_string}",true);}else if($_protocol=='HTTP/1.0'){header("HTTP/1.0 {$_code} {$_string}",true,$_code);}else{header("HTTP/1.1 {$_code} {$_string}",true,$_code);}}public function display($_output=''){if($_output=='')$_output=&$this->_final_output;if(count($this->_header)>0){foreach($this->_header as $header){header("$header[0]: $header[1]");}}if($this->_gzip_oc!=-1&&extension_loaded('zlib')){$_cond=isset($_SERVER['HTTP_ACCEPT_ENCODING'])&&(strpos($_SERVER['HTTP_ACCEPT_ENCODING'],'gzip')!==FALSE);if($_cond){$_output=gzencode($_output,$this->_gzip_oc);header('Content-Encoding: gzip');header('Vary: Accept-Encoding');header('Content-Length: '.strlen($_output));}}echo $_output;}}}class Model{public function __construct(){}}if((SR_INC_COMPONENTS&0x80)!=0){class Controller{public $uri=NULL;public $input=NULL;public $output=NULL;public $_G=NULL;public function __construct(){$this->_G=new stdClass();}public function run(){$_logicScript=$this->uri->page.'.logic.php';if(file_exists($_logicScript))include $_logicScript;else $this->uri->redirect('/error/404');}}}?>
