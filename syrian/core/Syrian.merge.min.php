<?php if(!defined('BASEPATH'))exit('No Direct Access Allowed!');define('SR_VERSION','2.0');defined('SR_CLI_MODE')or define('SR_CLI_MODE',strncmp(php_sapi_name(),'cli',3)=='cli');defined('SR_FLUSH_MODE')or define('SR_FLUSH_MODE','flush_mode');defined('SR_IGNORE_MODE')or define('SR_IGNORE_MODE','ignore_mode');defined('SR_INC_COMPONENTS')or define('SR_INC_COMPONENTS',0xFF);function _G($key,$val=null){static $_GRE=array();if(is_array($key)){foreach($key as $k=>$v){$_GRE[$k]=$v;}return true;}if($val===null){return isset($_GRE["{$key}"])?$_GRE["{$key}"]:null;}$_GRE["{$key}"]=&$val;return true;}function E($key,$val=null){static $_GRE=array();if(is_array($key)){foreach($key as $k=>$v){$_GRE[$k]=$v;}return true;}if($val===null){return isset($_GRE["{$key}"])?$_GRE["{$key}"]:null;}$_GRE["{$key}"]=&$val;return true;}function _cli_initialize(){$argv=&$_SERVER['argv'];$script_name=array_shift($argv);$_SERVER['SCRIPT_FILENAME']=$script_name;$_SERVER['REQUEST_URI']=null;$_SERVER['QUERY_STRING']=null;if(count($argv)<1)return;if(strlen($argv[0])>0&&strncmp($argv[0],'-',1)!=0){$request_uri=array_shift($argv);if($request_uri[0]!='/'){$request_uri="/{$request_uri}";}$_SERVER['REQUEST_URI']=$request_uri;if(($queryPos=strpos($request_uri,'?'))!==false){$query_string=substr($request_uri,$queryPos+1);$_SERVER['QUERY_STRING']=$query_string;$sIdx=0;$query_len=strlen($query_string);for($i=0;$i<$query_len;$i++){$eIdx=strpos($query_string,'=',$sIdx);if($eIdx===false)break;$args_name=substr($query_string,$sIdx,$eIdx-$sIdx);$sIdx=$eIdx+1;$eIdx=strpos($query_string,':',$sIdx);if($eIdx===false){$eIdx=strpos($query_string,'&',$sIdx);}if($eIdx===false){if($sIdx>=$query_len)break;$args_val=substr($query_string,$sIdx);}else{$args_val=substr($query_string,$sIdx,$eIdx-$sIdx);$sIdx=$eIdx+1;}$_GET[$args_name]=$args_val;$_POST[$args_name]=$args_val;}}}$args_num=count($argv);if($args_num>0){for($i=0;$i<$args_num;$i++){$args_name=$argv[$i];if(strlen($args_name)>1&&$args_name[0]!='-'){continue;}if($i<$args_num){$args_name=str_replace('-','_',substr($args_name,1));$_SERVER[strtoupper($args_name)]=$argv[++$i];}}}}function import($cls_path,$_inc=true){static $_loadedClass=array();$path=str_replace('.','/',$cls_path);if(isset($_loadedClass[$path])){unset($path);return true;}$_dir=(($_inc)?BASEPATH.'lib/':SR_LIBPATH);$_dir.=$path;$found=false;foreach(array("{$_dir}.class.php","{$_dir}.php")as $_file){if(file_exists($_file)){require $_file;$_loadedClass[$path]=true;$found=true;break;}}unset($path,$_dir);if($found==true){return true;}throw new Exception("import#Unable to load class with path {$cls_path}");}function config($config_path,$_inc=false,$cache=true){static $_loadedConf=array();if(($sIdx=strpos($config_path,'#'))!==false){$path=str_replace('.','/',substr($config_path,0,$sIdx));$keys=explode('.',substr($config_path,$sIdx+1));}else{$path=str_replace('.','/',$config_path);$keys=null;}$found=true;if(!isset($_loadedConf[$path])||$cache==false){$_dir=(($_inc)?BASEPATH.'/config/':SR_CONFPATH);$_dir.=$path;$found=false;foreach(array("{$_dir}.conf.php","{$_dir}.php")as $_file){if(file_exists($_file)){$found=true;$_loadedConf[$path]=include $_file;unset($_dir);break;}}unset($_dir);}if($found==false){unset($path,$keys);throw new Exception("config#Unable to load configure with path {$config_path}");}if($keys==null){return $_loadedConf[$path];}$vals=$_loadedConf[$path];foreach($keys as $key){if(!isset($vals[$key])){throw new Exception("config#Invalid key {$key}");}$vals=$vals[$key];}unset($path,$keys);return $vals;}function model($model_path,$cache=true){static $_clsLoaded=array();static $_loadedModel=array();if($cache==true&&isset($_loadedModel[$model_path])){return $_loadedModel[$model_path];}if(($sIdx=strrpos($model_path,'.'))!==false){$path=str_replace('.','/',substr($model_path,0,$sIdx+1));$model=substr($model_path,$sIdx+1);}else{$path=null;$model=$model_path;}$_dir=SR_MODELPATH."{$path}{$model}";foreach(array("{$_dir}.model.php","{$_dir}.php")as $_file){if(file_exists($_file)){if(!isset($_clsLoaded[$model_path])){$_clsLoaded[$model_path]=true;include $_file;}$class="{$model}Model";if(class_exists($class)){$obj=new $class();}else{$obj=new $model();}if($cache==true){$_loadedModel[$model_path]=$obj;}unset($path,$model,$_dir,$class);return $obj;}}throw new Exception("model#Unable to load model with path {$model}");}function helper($helper_path,$args=null,$_inc=false,$cache=true){static $_clsLoaded=array();static $_loadedHelper=array();if(($sIdx=strpos($helper_path,'#'))!==false){$package=str_replace('.','/',substr($helper_path,0,$sIdx));$method=substr($helper_path,$sIdx+1);}else{$package=str_replace('.','/',$helper_path);$method=null;}if($cache==true&&isset($_loadedHelper[$package])){$helperObj=$_loadedHelper[$package];}else{if(($sIdx=strrpos($package,'/'))!==false){$path=str_replace('.','/',substr($package,0,$sIdx+1));$helper=substr($package,$sIdx+1);}else{$path=null;$helper=$package;}$_dir=(($_inc)?BASEPATH.'/helper/':SR_HELPERPATH);$_dir.="{$path}{$helper}";$found=false;foreach(array("{$_dir}.helper.php","{$_dir}.php")as $_file){if(file_exists($_file)){if(!isset($_clsLoaded[$package])){$_clsLoaded[$package]=true;require $_file;}$found=true;$class="{$helper}Helper";$helperObj=new $class(null);if($cache==true){$_loadedHelper[$package]=$helperObj;}unset($path,$helper,$_dir,$class);break;}}if($found==false){unset($package,$method);throw new Exception("helper#Unable to load helper with path {$helper_path}");}}unset($package);if($method==null){return $helperObj;}if(!method_exists($helperObj,$method)){unset($helperObj);throw new Exception("helper#Undefined method {$method} for helper {$helper_path}");}return $helperObj->{$method}(is_array($args)?$args:array($args));}function abort($http_code){http_response_code($http_code);exit();}function build_view($type='html'){$e_name="{$type}_view_obj";if(($viewObj=E($e_name))==null){import('view.ViewFactory');$conf=$type=='html'?array('cache_time'=>0,'tpl_dir'=>SR_VIEWPATH,'cache_dir'=>SR_CACHEPATH.'tpl/'):null;$viewObj=ViewFactory::create($type,$conf);E($e_name,$viewObj);}return $viewObj;}function view($tpl,$vars=null,$sanitize=false,$timer=0){$viewObj=build_view();$viewObj->setCacheTime($timer);if($vars!=null)$viewObj->load($vars);return $viewObj->getContent($tpl,$sanitize);}function script($file,$argv=null){$scrip_file=SR_SCRIPTPATH.$file;if(!file_exists($scrip_file)){return null;}return include($scrip_file);}function view_assign($key,$val){$viewObj=build_view();if(is_array($key)){return $viewObj->load($key);}return $viewObj->assign($key,$val);}defined('VIEW_OK')or define('VIEW_OK',0);defined('VIEW_INFO')or define('VIEW_INFO',1);defined('VIEW_ERROR')or define('VIEW_ERROR',2);function view_report_register($err_code,$err_msg=null){static $symbol=null;if($symbol==null){$symbol=array();$viewObj=build_view();$viewObj->assoc('errors',$symbol);}$symbol[]=array('code'=>$err_code,'desc'=>$err_msg);}defined('PAGE_STD_STYLE')or define('PAGE_STD_STYLE',0);defined('PAGE_SHOP_STYLE')or define('PAGE_SHOP_STYLE',1);function view_paging_register($total,$pagesize,$pageno,$qstr=null,$name='pageno',$style=1,$left=2,$offset=2){static $symbol=null;if($symbol==null){$viewObj=build_view();$viewObj->assoc('page',$symbol);}if($qstr==null&&isset($_SERVER['QUERY_STRING'])){$qstr=$_SERVER['QUERY_STRING'];}if($qstr==null||strlen($qstr)<=1){$url="?{$name}=";}else{$pattern="/(&?){$name}=[^&]*&?/";$url=preg_replace($pattern,'$1',$qstr);if(($len=strlen($url))<1){$url="?{$name}=";}else if($url[$len-1]=='&'){$url="?{$url}{$name}=";}else{$url="?{$url}&{$name}=";}}$pages=ceil($total/$pagesize);if($pageno<1)$pageno=1;if($pageno>$pages)$pageno=$pages;$symbol=array('total'=>$total,'pages'=>$pages,'pageno'=>$pageno,'style'=>$style,'link'=>$url,'left'=>$left,'offset'=>$offset);}function view_scroll_register($total,$c_cursor,$p_cursor,$prevsign,$n_cursor,$nextsign,$qstr=null,$name='cursor'){static $symbol=null;if($symbol==null){$viewObj=build_view();$viewObj->assoc('page',$symbol);}if($qstr==null&&isset($_SERVER['QUERY_STRING'])){$qstr=$_SERVER['QUERY_STRING'];}if($qstr==null||strlen($qstr)<=1){$url="?{$name}=";}else{$pattern="/(&?){$name}=[^&]*&?/";$url=preg_replace($pattern,'$1',$qstr);if(($len=strlen($url))<1){$url="?{$name}=";}else if($url[$len-1]=='&'){$url="?{$url}{$name}=";}else{$url="?{$url}&{$name}=";}}$symbol=array('total'=>$total,'c_cursor'=>$c_cursor,'p_cursor'=>$p_cursor,'prevsign'=>$prevsign,'n_cursor'=>$n_cursor,'nextsign'=>$nextsign,'link'=>$url);}function redirect($uri,$args=null,$exit=true){if(is_array($args)){$arr=array();foreach($args as $k=>$v){$arr[]="{$k}={$v}";}$args='?'.implode('&',$arr);}else if(!is_null($args)){$args="?{$args}";}if($uri[0]!='/'&&strpos($uri,'://')===false){$uri="/{$uri}";}header("Location: {$uri}{$args}");if($exit)exit();}function parse_uri($uri,$separator='/',$default=null){if(($argsIdx=strpos($uri,'?'))!==false){$path=substr($uri,0,$argsIdx);}else{$path=$uri;}if(strlen($path)<1)return null;if($path[0]=='/')$path=substr($path,1);$uriBean=new StdClass();$uriBean->uri=$uri;$uriBean->path=$path;$uriBean->parts=null;$uriBean->package=null;$uriBean->module=null;$uriBean->page=null;if(strlen($path)>=1){$parts=explode($separator,$path);$length=count($parts);$uriBean->parts=$parts;switch($length){case 1:$uriBean->module=$parts[0];break;case 2:$uriBean->module=$parts[0];$uriBean->page=$parts[1];break;case 3:$uriBean->page=$parts[$length-1];$uriBean->module=$parts[$length-2];$uriBean->package=$parts[$length-3];break;default:$uriBean->page=array_pop($parts);$uriBean->module=array_pop($parts);$uriBean->package=implode('/',$parts);}unset($parts,$length);}if($uriBean->module==null){if(is_string($default)){$uriBean->module=$default;}else if(is_array($default)&&isset($default[0])){$uriBean->module=$default[0];}}if($uriBean->page==null){if(is_array($default)&&isset($default[1])){$uriBean->page=$default[1];}}unset($path);return $uriBean;}function controller($uri,$input,$output,$res_preload_callback=null,&$ctrl=null){if(is_string($uri))$uri=parse_uri($uri);$_ctrl_file=SR_CTRLPATH;if($uri->package!=null)$_ctrl_file.="{$uri->package}/";$_ctrl_file.="{$uri->module}/main.php";if(!file_exists($_ctrl_file)){throw new Exception("Unable to locate the controller with request uri {$uri->uri}",404);}if($res_preload_callback!=null){$res_preload_callback($uri);}require $_ctrl_file;$_class=ucfirst($uri->module).'Controller';if(!class_exists($_class)){throw new Exception("Undefined class {$_class} with request uri {$uri->uri}",404);}$ctrl=new $_class();$ret=$ctrl->run($input,$output,$uri);unset($_ctrl_file,$_class);return $ret;}function service($serv_path,$args,$executor=null,$asyn=true,$priority=null){if($executor==null){import('service.LocalExecutor');$executor=new LocalExecutor(null);}return $executor->execute($serv_path,$args,$asyn,$priority);}function session($key,$val=null){if(E('session_start')==false){session_start();E('session_start',true);}if($val===null){return isset($_SESSION[$key])?$_SESSION[$key]:null;}$_SESSION[$key]=$val;return true;}function session_close(){session_start();session_unset();setcookie(session_name(),'',time()-42000,'/');$save_path=session_save_path();if(strpos($save_path,';')===false){$sessFile="{$save_path}/sess_".session_id();if(file_exists($sessFile)){@unlink($sessFile);}}E('session_start',false);session_destroy();}function bkdr_hash($str){$hval=0;$len=strlen($str);for($i=0;$i<$len;$i++){$hval=(int)($hval*1331+(ord($str[$i])%127));}return($hval&0x7FFFFFFF);}function build_signature($factors,$timer=null){$seeds='=~!@#$%^&*()_+{}|\;:\',./<>"%%`~?~';$s_len=33;$random="0000";$hval=0;$slen=0;$encrypt=array('^');foreach($factors as $val){$encrypt[]=$val;$slen=strlen($val);$v="{$val}";$hval=ord($v[0]);$hval=$hval*131+ord($v[intval($slen/2)]);$hval=$hval*1331+ord($v[$slen-1]);$hval=($hval&0x7FFFFFFF);$sIdx=$hval%$s_len;for($i=0;$i<3;$i++){$random[$i]=$seeds[$sIdx++];if($sIdx>=$s_len){$sIdx=0;}}$random[3]='|';$encrypt[]=$random;}if($timer!=null){$encrypt[]="@{$timer}";}$encrypt[]='$';$sign_val=sha1(implode('',$encrypt));if($timer==null){return $sign_val;}return $sign_val.sprintf('%08x',$timer);}function valid_signature($factors,$signature,$expired=-1){$sign_len=strlen($signature);if($sign_len!=40&&$sign_len!=48){return false;}$timer=$sign_len==48?hexdec(substr($signature,40)):null;$sign_val=build_signature($factors,$timer);if(strncmp($sign_val,$signature,40)!=0){return false;}if($expired>0&&$timer!=null){if(time()-$timer>$expired){return false;}}return true;}function json_decode_array($str){return json_decode($str,true);}function set_query_args($key,$val=null,$src=null){if($src==null){if(!isset($_SERVER['QUERY_STRING']))return null;$src=$_SERVER['QUERY_STRING'];}if(!is_array($key)){$keys=array($key=>$val);}else{$keys=$key;}foreach($keys as $k=>$v){$len=strlen($src);if(preg_match("/([\?#&]?){$k}=[^&#]*([&#]?)/",$src,$m)!=1){$src=$len>0?"{$src}&{$k}={$v}":"{$src}{$k}={$v}";}else{$src=str_replace($m[0],"{$m[1]}{$k}={$v}{$m[2]}",$src);}}return $src;}function clear_query_args($key,$src=null){if($src==null){if(!isset($_SERVER['QUERY_STRING']))return null;$src=$_SERVER['QUERY_STRING'];}if(!is_array($key)){$keys=array($key);}else{$keys=$key;}foreach($keys as $k){$src=preg_replace("/([\?#&]?){$k}=[^&#]*([&#]?)/","$1$2",$src);}$src=preg_replace('/&{2,}/','&',$src);$src=preg_replace('/^&|&$/','',$src);return $src;}function get_query_args($key,$src=null){if($src==null){if(!isset($_SERVER['QUERY_STRING']))return null;$src=$_SERVER['QUERY_STRING'];}$pattern="/[#&\?]?{$key}=([^&#]*)/";return preg_match($pattern,$src,$m)==1?$m[1]:null;}function get_post_raw_data(){return file_get_contents("php://input");}function get_post_raw_data_json($assoc=false){return json_decode(file_get_contents("php://input"),$assoc);}class Helper{public function __construct($conf){}public function load(){$_argv=func_get_args();$_args=func_num_args();if($_args>0&&method_exists($this,$_argv[0])){$method=array_shift($_argv);return $this->{$method}($_argv);}exit("Error: Helper unable to load {$_argv[0]}\n");}}if((SR_INC_COMPONENTS&0x08)!=0){defined('OP_NULL')or define('OP_NULL',1<<0);defined('OP_LATIN')or define('OP_LATIN',1<<1);defined('OP_URL')or define('OP_URL',1<<2);defined('OP_EMAIL')or define('OP_EMAIL',1<<3);defined('OP_QQ')or define('OP_QQ',1<<4);defined('OP_DATE')or define('OP_DATE',1<<5);defined('OP_NUMERIC')or define('OP_NUMERIC',1<<6);defined('OP_STRING')or define('OP_STRING',1<<7);defined('OP_ZIP')or define('OP_ZIP',1<<8);defined('OP_MOBILE')or define('OP_MOBILE',1<<9);defined('OP_TEL')or define('OP_TEL',1<<10);defined('OP_IDENTIRY')or define('OP_IDENTIRY',1<<11);defined('OP_SANITIZE_TRIM')or define('OP_SANITIZE_TRIM',1<<0);defined('OP_SANITIZE_SCRIPT')or define('OP_SANITIZE_SCRIPT',1<<1);defined('OP_SANITIZE_HTML')or define('OP_SANITIZE_HTML',1<<2);defined('OP_MAGIC_QUOTES')or define('OP_MAGIC_QUOTES',1<<3);defined('OP_SANITIZE_INT')or define('OP_SANITIZE_INT',1<<4);defined('OP_LOWERCASE')or define('OP_LOWERCASE',1<<5);defined('OP_UPPERCASE')or define('OP_UPPERCASE',1<<6);if(!function_exists('OP_LIMIT')){function OP_LIMIT($s,$e=-1){return($e==-1?array(0,$s):array(0,$s,$e));}}if(!function_exists('OP_SIZE')){function OP_SIZE($s,$e=-1){return($e==-1?array(1,$s):array(1,$s,$e));}}class Input{public function __construct(){}public static function string2Boolean($val){if(is_bool($val)){return $val;}else if(is_string($val)){$val=strtolower($val);if($val=='true')return true;else if($val=='false')return false;else{$i=intval($val);return $i>0?true:false;}}else if(is_integer($val)){return $val>0?true:false;}return false;}public function get($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_GET[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_GET,$_key,$_model,$_errno);}return $_GET[$_key];}public function getMust($_key,$_model,$_must){$v=$this->get($_key,$_model,$_must);return $v===false?$_must:$v;}public function getInt($_key,$_default=false,$allow_nagative=false){if(!isset($_GET[$_key]))return $_default;$v=intval($_GET[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function getBoolean($_key){if(!isset($_GET[$_key]))return false;return self::string2Boolean($_GET[$_key]);}public function getUID($_key,$compatible=false,$default=false){if(!isset($_GET[$_key]))return $default;$v=$_GET[$_key];$len=strlen($v);if($len==24||$len==32){return self::isValidUid($v)?$v:false;}else if($compatible&&$len<=19){return intval($v);}return false;}public function getModel($_model,&$_errno=NULL){import('Filter');return Filter::loadFromModel($_GET,$_model,$_errno);}public function post($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_POST[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_POST,$_key,$_model,$_errno);}return $_POST[$_key];}public function postMust($_key,$_model,$_must){$v=$this->post($_key,$_model,$_must);return $v===false?$_must:$v;}public function postInt($_key,$_default=false,$allow_nagative=false){if(!isset($_POST[$_key]))return $_default;$v=intval($_POST[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function postBoolean($_key){if(!isset($_POST[$_key]))return false;return self::string2Boolean($_POST[$_key]);}public function postUID($_key,$compatible=false,$default=false){if(!isset($_POST[$_key]))return $default;$v=$_POST[$_key];$len=strlen($v);if($len==24||$len==32){return self::isValidUid($v)?$v:false;}else if($compatible&&$len<=19){return intval($v);}return false;}public function postModel($_model,&$_errno=NULL){import('Filter');return Filter::loadFromModel($_POST,$_model,$_errno);}public function cookie($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_COOKIE[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_COOKIE,$_key,$_model,$_errno);}return $_COOKIE[$_key];}public function cookieMust($_key,$_model,$_must){$v=$this->cookie($_key,$_model,$_must);return $v===false?$_must:$v;}public function cookieInt($_key,$_default=false,$allow_nagative=false){if(!isset($_COOKIE[$_key]))return $_default;$v=intval($_COOKIE[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function cookieBoolean($_key){if(!isset($_COOKIE[$_key]))return false;return self::string2Boolean($_COOKIE[$_key]);}public function cookieUID($_key,$compatible=false,$default=false){if(!isset($_COOKIE[$_key]))return $default;$v=$_COOKIE[$_key];$len=strlen($v);if($len==24||$len==32){return self::isValidUid($v)?$v:false;}else if($compatible&&$len<=19){return intval($v);}return false;}public function cookieModel($_model,&$_errno=NULL){import('Filter');return Filter::loadFromModel($_COOKIE,$_model,$_errno);}public function session($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_SESSION[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_SESSION,$_key,$_model,$_errno);}return $_SESSION[$_key];}public function request($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_REQUEST[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_REQUEST,$_key,$_model,$_errno);}return $_REQUEST[$_key];}public function requestMust($_key,$_model,$_must){$v=$this->request($_key,$_model,$_must);return $v===false?$_must:$v;}public function requestInt($_key,$_default=false,$allow_nagative=false){if(!isset($_REQUEST[$_key]))return $_default;$v=intval($_REQUEST[$_key]);if($v<0&&$allow_nagative==false){return false;}return $v;}public function requestBoolean($_key){if(!isset($_REQUEST[$_key]))return false;return self::string2Boolean($_REQUEST[$_key]);}public function requestUID($_key,$compatible=false,$default=false){if(!isset($_REQUEST[$_key]))return $default;$v=$_REQUEST[$_key];$len=strlen($v);if($len==24||$len==32){return self::isValidUid($v)?$v:false;}else if($compatible&&$len<=19){return intval($v);}return false;}public function requestModel($_model,&$_errno=NULL){import('Filter');return Filter::loadFromModel($_REQUEST,$_model,$_errno);}public function server($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_SERVER[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_SERVER,$_key,$_model,$_errno);}return $_SERVER[$_key];}public function env($_key,$_model=NULL,$_default=false,&$_errno=NULL){if(!isset($_ENV[$_key]))return $_default;if($_model!=NULL){import('Filter');return Filter::get($_ENV,$_key,$_model,$_errno);}return $_ENV[$_key];}private static function isValidUid($string){$len=strlen($string);for($i=0;$i<$len;$i++){$ascii=ord($string[$i]);if(($ascii>=48&&$ascii<=57)||($ascii>=97&&$ascii<=122)){continue;}return false;}return true;}}}if((SR_INC_COMPONENTS&0x20)!=0){class Output{private $_header=array();private $_final_output='';private $_zlib_oc=false;private $_gzip_oc=-1;public function __construct(){$this->_zlib_oc=@ini_get('zlib.output_compression');if(SR_CLI_MODE!=true){if(defined('SR_CHARSET')){$this->setHeader('Content-Type','text/html; charset= '.SR_CHARSET);}$this->setHeader('X-Powered-By',defined(SR_POWERBY)?SR_POWERBY:'Syrian/2.0');}}public function compress($_level){if($this->_zlib_oc==TRUE)return;if($_level>=1&&$_level<=9){$this->_gzip_oc=$_level;}}public function setHeader($_header,$_replace){if($this->_zlib_oc&&strncasecmp($_header,'content-length')==0){return;}$this->_header[$_header]=$_replace;return $this;}public function setOutput(){$this->_final_output=$_output;return $this;}public function append($_str){$this->_final_output.=$_str;return $this;}public function setStatusHeader($_code,$_string=''){static $_status=array(200=>'OK',201=>'Created',202=>'Accepted',203=>'Non-Authoritative Information',204=>'No Content',205=>'Reset Content',206=>'Partial Content',300=>'Multiple Choices',301=>'Moved Permanently',302=>'Found',304=>'Not Modified',305=>'Use Proxy',307=>'Temporary Redirect',400=>'Bad Request',401=>'Unauthorized',403=>'Forbidden',404=>'Not Found',405=>'Method Not Allowed',406=>'Not Acceptable',407=>'Proxy Authentication Required',408=>'Request Timeout',409=>'Conflict',410=>'Gone',411=>'Length Required',412=>'Precondition Failed',413=>'Request Entity Too Large',414=>'Request-URI Too Long',415=>'Unsupported Media Type',416=>'Requested Range Not Satisfiable',417=>'Expectation Failed',500=>'Internal Server Error',501=>'Not Implemented',502=>'Bad Gateway',503=>'Service Unavailable',504=>'Gateway Timeout',505=>'HTTP Version Not Supported');if(!isset($_status[$_code]))exit('Error: Invalid http status code');if($_string=='')$_string=&$_status[$_code];$_protocol=isset($_SERVER['SERVER_PROTOCOL'])?$_SERVER['SERVER_PROTOCOL']:FALSE;if(substr(php_sapi_name(),0,3)=='cgi'){header("Status: {$_code} {$_string}",true);}else if($_protocol=='HTTP/1.0'){header("HTTP/1.0 {$_code} {$_string}",true,$_code);}else{header("HTTP/1.1 {$_code} {$_string}",true,$_code);}}public function display($_output=''){if($_output=='')$_output=&$this->_final_output;if(count($this->_header)>0){foreach($this->_header as $hKey=>$hVal){header("{$hKey}: {$hVal}");}}if($this->_gzip_oc!=-1&&extension_loaded('zlib')){$_cond=isset($_SERVER['HTTP_ACCEPT_ENCODING'])&&(strpos($_SERVER['HTTP_ACCEPT_ENCODING'],'gzip')!==FALSE);if($_cond){$_output=gzencode($_output,$this->_gzip_oc);header('Content-Encoding: gzip');header('Vary: Accept-Encoding');header('Content-Length: '.strlen($_output));}}echo $_output;}}}if((SR_INC_COMPONENTS&0x80)!=0){class Controller{protected $method_prefix='action';public function __construct(){_G(array(SR_FLUSH_MODE=>false,SR_IGNORE_MODE=>false));$this->conf=config('app');}protected function __init($input,$output,$uri){$flushMode=$input->getInt('__flush_mode__',0);if($flushMode==1&&strcmp($this->conf->flush_key,$input->get('__flush_key__'))==0){_G(SR_FLUSH_MODE,true);}$ignoreMode=$input->getInt('__ignore_mode__',0);if($ignoreMode==1){_G(SR_IGNORE_MODE,true);}}public function run($input,$output,$uri){$this->__init($input,$output,$uri);$ret=NULL;if(method_exists($this,'__before')){$this->__before($input,$output,$uri);}$method="{$this->method_prefix}{$uri->page}";if(method_exists($this,$method)){$ret=$this->{$method}($input,$output,$uri);}else{throw new Exception("Undefined handler \"{$method}\" for ".__class__);}if(method_exists($this,'__after')){$this->__after($input,$output,$uri);}return $ret;}}}if(SR_CLI_MODE){_cli_initialize();if(isset($_SERVER['PROCESS_TITLE'])){@cli_set_process_title($_SERVER['PROCESS_TITLE']);}} ?>
